import{r as e,e as a,w as l,L as t,j as s,O as i,K as o,Q as u,B as n,F as v,$ as r,_ as d,P as m,I as c,N as p,R as h}from"./vue-vendor-BDmscHTi.js";import{u as y}from"./useHistory-Dm2P6k7J.js";import{f}from"./divination-C-nR8R13.js";import{_ as g}from"./index-BiwZp9Zd.js";import{J as _,a as x}from"./vant-ui-B5UknOXi.js";import"./axios-lib-7ZUa9Kmg.js";const b={class:"history"},k={class:"content"},V={class:"filter-bar"},w={key:0,class:"no-history"},C={key:1,class:"history-list"},I={class:"history-item-content"},j={class:"hexagram-symbol"},q={class:"history-item-info"},B={class:"history-item-header"},D={class:"hexagram-name"},R={class:"history-date"},U={class:"history-item-question"},H={class:"history-item-footer"},L={key:0,class:"record-detail"},T={class:"detail-header"},z={class:"detail-hexagram"},A={class:"detail-info"},J={class:"detail-date"},N={class:"detail-method"},O={key:0,class:"detail-question"},S={key:1,class:"detail-interpretation"},F={key:2,class:"detail-ai-interpretation"},K={key:3,class:"detail-notes"},P={class:"detail-actions"},Q=g({__name:"HistoryView",setup(g){const Q=c(),{getHistory:$,deleteRecord:E,clearHistory:G,error:M}=y(),W=e(!1),X=e(!1),Y=e(!1),Z=e([]),ee=e([]),ae=e(1),le=e(!1),te=e(null),se=e("all"),ie=e("newest"),oe=[{text:"全部方式",value:"all"},{text:"梅花易数",value:"plum-blossom"},{text:"铜钱卦",value:"coin"}],ue=[{text:"最新优先",value:"newest"},{text:"最早优先",value:"oldest"}];a(()=>{ne()}),l([se,ie],()=>{ae.value=1,ee.value=[],X.value=!1,ne(!0)});const ne=(e=!1)=>{const a={};"all"!==se.value&&(a.method=se.value),Z.value=$(a),"oldest"===ie.value?Z.value.sort((e,a)=>new Date(e.timestamp)-new Date(a.timestamp)):Z.value.sort((e,a)=>new Date(a.timestamp)-new Date(e.timestamp)),e?(ee.value=[],re()):re()},ve=()=>{re()},re=()=>{setTimeout(()=>{const e=10*(ae.value-1),a=e+10,l=Z.value.slice(e,a);Y.value?(ee.value=l,Y.value=!1):ee.value=[...ee.value,...l],ae.value++,W.value=!1,ee.value.length>=Z.value.length&&(X.value=!0)},300)},de=()=>{X.value=!1,ae.value=1,ne(!0)},me=e=>f(e),ce=()=>{te.value&&(sessionStorage.setItem("selectedDivinationRecord",JSON.stringify(te.value)),Q.push("/interpretation"),le.value=!1)},pe=()=>{Q.push("/")},he=()=>{_({title:"确认清空",message:"确定要清空所有历史记录吗？",confirmButtonText:"清空",confirmButtonColor:"#ee0a24"}).then(()=>{G()?(x("清空成功"),Z.value=[],ee.value=[],X.value=!0):x({type:"fail",message:M.value||"清空失败"})}).catch(()=>{})};return(e,a)=>{const l=o("van-nav-bar"),c=o("van-dropdown-item"),y=o("van-dropdown-menu"),f=o("van-button"),g=o("van-empty"),Q=o("van-tag"),$=o("van-cell-group"),G=o("van-swipe-cell"),ae=o("van-list"),ne=o("van-pull-refresh"),ye=o("van-dialog");return p(),t("div",b,[s(l,{title:"历史记录","left-text":"返回","left-arrow":"",onClickLeft:pe,"right-text":"清空",onClickRight:he,fixed:""}),i("div",k,[i("div",V,[s(y,{overlay:!1},{default:u(()=>[s(c,{modelValue:se.value,"onUpdate:modelValue":a[0]||(a[0]=e=>se.value=e),options:oe},null,8,["modelValue"]),s(c,{modelValue:ie.value,"onUpdate:modelValue":a[1]||(a[1]=e=>ie.value=e),options:ue},null,8,["modelValue"])]),_:1})]),0===Z.value.length?(p(),t("div",w,[s(g,{description:"暂无历史记录",image:"search"},{bottom:u(()=>[a[7]||(a[7]=i("p",{class:"empty-tip"},"您还没有进行过卜卦",-1)),s(f,{round:"",type:"primary",class:"bottom-button",to:"/divination"},{default:u(()=>a[6]||(a[6]=[n(" 去卜卦 ",-1)])),_:1,__:[6]})]),_:1})])):(p(),t("div",C,[s(ne,{modelValue:Y.value,"onUpdate:modelValue":a[3]||(a[3]=e=>Y.value=e),onRefresh:de},{default:u(()=>[s(ae,{modelValue:W.value,"onUpdate:modelValue":a[2]||(a[2]=e=>W.value=e),finished:X.value,"finished-text":"没有更多了",onLoad:ve},{default:u(()=>[(p(!0),t(v,null,r(ee.value,e=>(p(),t("div",{key:e.id,class:"history-item-wrapper"},[s(G,null,{right:u(()=>[s(f,{square:"",type:"danger",class:"delete-button",text:"删除",onClick:a=>{return l=e.id,void _({title:"确认删除",message:"确定要删除这条记录吗？",confirmButtonText:"删除",confirmButtonColor:"#ee0a24"}).then(()=>{E(l)?(x("删除成功"),ee.value=ee.value.filter(e=>e.id!==l),ee.value.length<10&&!X.value&&re()):x({type:"fail",message:M.value||"删除失败"})}).catch(()=>{});var l}},null,8,["onClick"])]),default:u(()=>[s($,{inset:"",border:!1,class:"history-item",onClick:a=>(e=>{te.value=e,le.value=!0})(e)},{default:u(()=>[i("div",I,[i("div",j,m(e.hexagram?.symbol||"⚊⚊"),1),i("div",q,[i("div",B,[i("span",D,m(e.hexagram?.name||"未知卦象"),1),i("span",R,m(me(e.timestamp).relative),1)]),i("div",U,m(e.question||"无问题描述"),1),i("div",H,[s(Q,{type:"plum-blossom"===e.method?"primary":"success",plain:"",size:"small"},{default:u(()=>[n(m("plum-blossom"===e.method?"梅花易数":"铜钱卦"),1)]),_:2},1032,["type"]),e.aiInterpretation?(p(),h(Q,{key:0,type:"warning",plain:"",size:"small"},{default:u(()=>a[8]||(a[8]=[n(" AI解卦 ",-1)])),_:1,__:[8]})):d("",!0)])])])]),_:2},1032,["onClick"])]),_:2},1024)]))),128))]),_:1},8,["modelValue","finished"])]),_:1},8,["modelValue"])]))]),s(ye,{modelValue:le.value,"onUpdate:modelValue":a[5]||(a[5]=e=>le.value=e),title:"卦象详情","show-confirm-button":!1,class:"detail-dialog"},{default:u(()=>[te.value?(p(),t("div",L,[i("div",T,[i("div",z,m(te.value.hexagram?.symbol||"⚊⚊"),1),i("div",A,[i("h3",null,m(te.value.hexagram?.name||"未知卦象"),1),i("p",J,m(me(te.value.timestamp).date)+" "+m(me(te.value.timestamp).time),1),i("p",N,m("plum-blossom"===te.value.method?"梅花易数":"铜钱卦"),1)])]),te.value.question?(p(),t("div",O,[a[9]||(a[9]=i("h4",null,"问题",-1)),i("p",null,m(te.value.question),1)])):d("",!0),te.value.interpretation?(p(),t("div",S,[a[10]||(a[10]=i("h4",null,"传统解卦",-1)),i("p",null,m(te.value.interpretation),1)])):d("",!0),te.value.aiInterpretation?(p(),t("div",F,[a[11]||(a[11]=i("h4",null,"AI解卦",-1)),i("p",null,m(te.value.aiInterpretation),1)])):d("",!0),te.value.notes?(p(),t("div",K,[a[12]||(a[12]=i("h4",null,"备注",-1)),i("p",null,m(te.value.notes),1)])):d("",!0),i("div",P,[s(f,{type:"primary",block:"",onClick:ce},{default:u(()=>a[13]||(a[13]=[n("查看完整解卦",-1)])),_:1,__:[13]}),s(f,{type:"default",block:"",onClick:a[4]||(a[4]=e=>le.value=!1)},{default:u(()=>a[14]||(a[14]=[n("关闭",-1)])),_:1,__:[14]})])])):d("",!0)]),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-70176212"]]);export{Q as default};
