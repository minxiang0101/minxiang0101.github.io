import{r as a,K as e,L as s,N as l,j as i,O as n,Q as t,_ as o,F as v,$ as u,B as c,P as r,y as d,a0 as m,R as p,c as y,w as g,e as h,S as f,I as _}from"./vue-vendor-BDmscHTi.js";import{P as b}from"./PlumBlossomInput-D9yD88VU.js";import{u as k,C as T,a as x,A as w}from"./useDivination-DOHOnCaD.js";import{H as D}from"./HexagramDisplay-_dpELlWn.js";import{_ as C}from"./index-BiwZp9Zd.js";import{a as H}from"./vant-ui-B5UknOXi.js";import"./divination-C-nR8R13.js";import"./axios-lib-7ZUa9Kmg.js";const I={class:"coin-toss"},j={class:"toss-section"},L={class:"toss-progress"},M={class:"coins-container"},A={key:0,class:"toss-result"},S=["innerHTML"],O={class:"line-name"},R={key:0,class:"changing-indicator"},z={key:1,class:"toss-history"},E={class:"history-lines"},P={class:"history-position"},$=["innerHTML"],B={class:"history-value"},N={class:"action-section"},q={class:"hexagram-result"},F={class:"result-actions"},J=C({__name:"CoinToss",emits:["divination-complete"],setup(y,{emit:g}){const{coinDivination:h,tossCoin:f}=k(),_=a(0),b=a(["head","head","head"]),w=a(!1),C=a(!1),J=a([]),K=a(null),Q=a(null),U=a(!1),V=a(!1),G=a(""),W=a(0),X=a(!1);(async()=>{try{const a=await h();K.value=a.inputData}catch(a){H({type:"fail",message:a.message||"初始化失败"})}})();const Y=async()=>{if(!w.value&&!V.value)try{w.value=!0,C.value=!1,await Z();const a=await f(K.value);K.value=a.inputData;const e=K.value.tosses[K.value.tosses.length-1];b.value=e.coins,G.value=e.lineType,W.value=e.value,X.value=e.changing,J.value.push(e),_.value=K.value.tosses.length,C.value=!0,K.value.isComplete&&(V.value=!0,Q.value=a.hexagram,setTimeout(()=>{U.value=!0},1e3))}catch(a){H({type:"fail",message:a.message||"抛硬币失败"})}finally{w.value=!1}},Z=async()=>new Promise(a=>{const e=setInterval(()=>{b.value=[Math.random()>.5?x.HEAD:x.TAIL,Math.random()>.5?x.HEAD:x.TAIL,Math.random()>.5?x.HEAD:x.TAIL]},100);setTimeout(()=>{clearInterval(e),a()},800)}),aa=()=>{U.value=!1;const a={hexagram:Q.value,inputData:{...K.value,method:"coin"}};la("divination-complete",a)},ea=a=>T[a]?.name||"",sa=(a,e)=>e?"yang"===a?'<div class="line-yang line-changing"><span class="changing-dot"></span></div>':'<div class="line-yin line-changing"><span class="changing-dot"></span></div>':"yang"===a?'<div class="line-yang"></div>':'<div class="line-yin"><div class="line-yin-gap"></div></div>',la=g;return(a,y)=>{const g=e("van-card"),h=e("van-step"),f=e("van-steps"),k=e("van-button"),T=e("van-popup");return l(),s("div",I,[i(g,{class:"input-card",border:!1},{title:t(()=>y[0]||(y[0]=[n("div",{class:"card-title"},"铜钱卦卜卦",-1)])),desc:t(()=>y[1]||(y[1]=[n("div",{class:"card-desc"},"通过抛掷三枚铜钱六次，系统将根据结果生成卦象",-1)])),_:1}),n("div",j,[n("div",L,[i(f,{active:_.value,"active-color":"#8b0000"},{default:t(()=>[(l(),s(v,null,u(6,a=>i(h,{key:a},{default:t(()=>[c("第"+r(a)+"爻",1)]),_:2},1024)),64))]),_:1},8,["active"])]),n("div",M,[i(m,{name:"coin-flip",tag:"div",class:"coins"},{default:t(()=>[(l(!0),s(v,null,u(b.value,(a,e)=>(l(),s("div",{key:`coin-${e}`,class:d(["coin",[a,{"coin-animated":w.value}]])},y[2]||(y[2]=[n("div",{class:"coin-inner"},[n("div",{class:"coin-front"}),n("div",{class:"coin-back"})],-1)]),2))),128))]),_:1})]),C.value?(l(),s("div",A,[n("div",{class:d(["result-line",{"result-line--yin":"yin"===G.value,"result-line--yang":"yang"===G.value}])},[n("div",{class:"line-symbol",innerHTML:sa(G.value,X.value)},null,8,S),n("div",O,r(ea(W.value)),1),X.value?(l(),s("div",R,"变爻")):o("",!0)],2)])):o("",!0),J.value.length>0?(l(),s("div",z,[y[3]||(y[3]=n("div",{class:"history-title"},"已完成爻线",-1)),n("div",E,[(l(!0),s(v,null,u(J.value,(a,e)=>(l(),s("div",{key:`history-${e}`,class:d(["history-line",{"history-line--yin":"yin"===a.lineType,"history-line--yang":"yang"===a.lineType,"history-line--changing":a.changing}])},[n("div",P,r(a.position),1),n("div",{class:"history-symbol",innerHTML:sa(a.lineType,a.changing)},null,8,$),n("div",B,r(ea(a.value)),1)],2))),128))])])):o("",!0),n("div",N,[i(k,{type:"primary",block:"",disabled:w.value||V.value,onClick:Y},{default:t(()=>[c(r(V.value?"卜卦完成":w.value?"抛掷中...":0===_.value?"开始抛硬币":"抛掷第"+(_.value+1)+"次"),1)]),_:1},8,["disabled"])])]),i(T,{show:U.value,round:"",closeable:"",position:"bottom",style:{height:"83%"}},{default:t(()=>[n("div",q,[y[5]||(y[5]=n("div",{class:"result-title"},"卜卦结果",-1)),Q.value?(l(),p(D,{key:0,hexagram:Q.value,"show-changing":!0,"show-info":!0,"show-interpretation":!0},null,8,["hexagram"])):o("",!0),n("div",F,[i(k,{type:"primary",block:"",onClick:aa},{default:t(()=>y[4]||(y[4]=[c("确认结果",-1)])),_:1,__:[4]})])])]),_:1},8,["show"])])}}},[["__scopeId","data-v-b3a2ac44"]]),K={class:"divination"},Q={class:"content"},U={key:0,class:"steps-guide"},V={key:1,class:"method-selection"},G={key:2,class:"divination-process"},W={class:"page-title"},X={key:0,class:"plum-blossom"},Y={key:1,class:"coin-toss"},Z={class:"action-buttons"},aa={class:"loading-container"},ea={class:"loading-text"},sa=C({__name:"DivinationView",setup(v){const u=_(),d=f(),m=a(null),p=a(!1),k=a("正在准备卜卦..."),T=a(0),x=y(()=>"plum-blossom"===m.value?"梅花易数卜卦":"coin"===m.value?"铜钱卦卜卦":"选择卜卦方式"),D=a=>{L("正在准备卜卦..."),setTimeout(()=>{m.value=a,T.value=1,M()},w.SHORT)},C=()=>{L("正在返回..."),setTimeout(()=>{m.value=null,T.value=0,M()},w.SHORT)},I=()=>{m.value?C():u.push("/")},j=a=>{if(a&&a.hexagram){L("正在生成卦象..."),T.value=2;const e={hexagram:a.hexagram,inputData:{...a.inputData,method:m.value||"coin"}};setTimeout(()=>{sessionStorage.setItem("divinationResult",JSON.stringify(e)),T.value=3,setTimeout(()=>{M(),u.push("/interpretation"),H({type:"success",message:"卜卦成功"})},w.SHORT)},w.MEDIUM)}else H({type:"fail",message:"卜卦失败，请重试"})},L=a=>{k.value=a,p.value=!0},M=()=>{p.value=!1};return g(m,a=>{T.value=a?1:0}),h(()=>{const a=d.query.method;"plum-blossom"!==a&&"coin"!==a||D(a)}),(a,v)=>{const u=e("van-nav-bar"),d=e("van-step"),y=e("van-steps"),g=e("van-icon"),h=e("van-cell"),f=e("van-cell-group"),_=e("van-button"),w=e("van-loading"),H=e("van-overlay");return l(),s("div",K,[i(u,{title:"卜卦","left-text":"返回","left-arrow":"",onClickLeft:I,fixed:""}),n("div",Q,[m.value?(l(),s("div",U,[i(y,{active:T.value,"active-color":"#8b0000"},{default:t(()=>[i(d,null,{default:t(()=>v[2]||(v[2]=[c("选择方式",-1)])),_:1,__:[2]}),i(d,null,{default:t(()=>[c(r("plum-blossom"===m.value?"输入数字":"抛掷铜钱"),1)]),_:1}),i(d,null,{default:t(()=>v[3]||(v[3]=[c("生成卦象",-1)])),_:1,__:[3]}),i(d,null,{default:t(()=>v[4]||(v[4]=[c("查看解卦",-1)])),_:1,__:[4]})]),_:1},8,["active"])])):o("",!0),m.value?(l(),s("div",G,[n("h2",W,r(x.value),1),"plum-blossom"===m.value?(l(),s("div",X,[i(b,{onDivinationComplete:j})])):"coin"===m.value?(l(),s("div",Y,[i(J,{onDivinationComplete:j})])):o("",!0),n("div",Z,[i(_,{type:"default",block:"",onClick:C},{default:t(()=>v[8]||(v[8]=[c(" 重新选择卜卦方式 ",-1)])),_:1,__:[8]})])])):(l(),s("div",V,[v[7]||(v[7]=n("h2",{class:"page-title"},"选择卜卦方式",-1)),i(f,{inset:""},{default:t(()=>[i(h,{title:"梅花易数","is-link":"",onClick:v[0]||(v[0]=a=>D("plum-blossom")),center:""},{"right-icon":t(()=>[i(g,{name:"flower-o",size:"24",color:"var(--primary-color)"})]),label:t(()=>v[5]||(v[5]=[n("span",null,"通过数字演算卦象",-1)])),_:1}),i(h,{title:"铜钱卦","is-link":"",onClick:v[1]||(v[1]=a=>D("coin")),center:""},{"right-icon":t(()=>[i(g,{name:"gold-coin-o",size:"24",color:"var(--primary-color)"})]),label:t(()=>v[6]||(v[6]=[n("span",null,"模拟抛掷铜钱得卦",-1)])),_:1})]),_:1})]))]),i(H,{show:p.value,"z-index":9999},{default:t(()=>[n("div",aa,[i(w,{type:"spinner",color:"#8b0000",size:"48px"}),n("div",ea,r(k.value),1)])]),_:1},8,["show"])])}}},[["__scopeId","data-v-8d684746"]]);export{sa as default};
