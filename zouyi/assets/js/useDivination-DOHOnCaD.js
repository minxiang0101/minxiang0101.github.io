import{g as n,b as e,d as a,c as t,a as r,T as i}from"./HexagramDisplay-_dpELlWn.js";import{c as s,a as o,b as l,d as g}from"./divination-C-nR8R13.js";import{r as m}from"./vue-vendor-BDmscHTi.js";const u={6:{name:"老阴",type:"yin",changing:!0,symbol:"- ○ -"},7:{name:"少阳",type:"yang",changing:!1,symbol:"———"},8:{name:"少阴",type:"yin",changing:!1,symbol:"— —"},9:{name:"老阳",type:"yang",changing:!0,symbol:"—○—"}},p={HEAD:"head",TAIL:"tail"},c={SHORT:200,MEDIUM:500,LONG:1e3,COIN_TOSS:1500};function h(){const u=m(!1),c=m(null),h=m(null),y=(e,s,o)=>{const l=v(e),g=v(s);if(!l||!g)throw new Error("无法根据数字生成有效的八卦");const m=i[l],u=i[g],p=a(l,g);if(!p)throw new Error("无法生成有效的卦象");const c=[],h=o>0?[o]:[];for(let a=0;a<3;a++){const e=a+1,t="1"===u.binary.charAt(a)?"yang":"yin",i=e===o;c.push(r({position:e,type:t,changing:i,symbol:n(t,i),strength:"yang"===t?i?9:7:i?6:8}))}for(let a=0;a<3;a++){const e=a+4,t="1"===m.binary.charAt(a)?"yang":"yin",i=e===o;c.push(r({position:e,type:t,changing:i,symbol:n(t,i),strength:"yang"===t?i?9:7:i?6:8}))}return t({id:`hexagram-${p.number}`,name:p.name,symbol:p.symbol,upperTrigram:l,lowerTrigram:g,changingLines:h,lines:c,interpretation:p.interpretation,number:p.number})},b=i=>{if(!Array.isArray(i)||6!==i.length)throw new Error("需要六次抛硬币结果");const s=i.filter(n=>n.changing).map(n=>n.position),o=i.map(e=>r({position:e.position,type:e.lineType,changing:e.changing,symbol:n(e.lineType,e.changing),strength:e.value})),l=i.slice(0,3).map(n=>"yang"===n.lineType?"1":"0").join(""),g=i.slice(3,6).map(n=>"yang"===n.lineType?"1":"0").join(""),m=e(l),u=e(g);if(!m||!u)throw new Error("无法根据爻生成有效的八卦");const p=a(u,m);if(!p)throw new Error("无法生成有效的卦象");return t({id:`hexagram-${p.number}`,name:p.name,symbol:p.symbol,upperTrigram:u,lowerTrigram:m,changingLines:s,lines:o,interpretation:p.interpretation,number:p.number})},w=n=>{const e=parseInt(n,10);if(isNaN(e))throw new Error("输入必须是有效数字");let a=e%9;return 0===a&&(a=9),a},T=(n,e)=>{if(n.length>2){const e=w(n[2]);return e>6?e-6:e}return e%24%6+1},v=n=>({1:"乾",2:"兑",3:"离",4:"震",5:"巽",6:"坎",7:"艮",8:"坤",9:"乾"}[n]||null);return{isProcessing:u,error:c,result:h,plumBlossomDivination:(n,e="manual")=>{try{if(u.value=!0,c.value=null,!Array.isArray(n)||0===n.length)throw new Error("请提供有效的数字输入");const a=w(n[0]),t=n.length>1?w(n[1]):w(n[0]+1),r=(new Date).getHours(),i=T(n,r),s=g({numbers:n,upperNumber:a,lowerNumber:t,timeNumber:r,changingLine:i,method:e,timestamp:(new Date).toISOString()}),o=y(a,t,i);return h.value={hexagram:o,inputData:s},h.value}catch(a){throw c.value=a.message,a}finally{u.value=!1}},coinDivination:(n=null)=>{try{u.value=!0,c.value=null;const e=l({tosses:[],totalTosses:0,startTime:(new Date).toISOString(),endTime:null,isComplete:!1});if(n&&Array.isArray(n)&&6===n.length){const a=n.map((n,e)=>{const{value:a,lineType:t,changing:r}=s(n);return o({coins:n,lineType:t,changing:r,position:e+1,value:a,timestamp:(new Date).toISOString()})});e.tosses=a,e.totalTosses=6,e.isComplete=!0,e.endTime=(new Date).toISOString();const t=b(a);return h.value={hexagram:t,inputData:e},h.value}return h.value={hexagram:null,inputData:e},h.value}catch(e){throw c.value=e.message,e}finally{u.value=!1}},tossCoin:n=>{try{if(n.isComplete)throw new Error("卜卦已完成");const e=[Math.random()>.5?p.HEAD:p.TAIL,Math.random()>.5?p.HEAD:p.TAIL,Math.random()>.5?p.HEAD:p.TAIL],{value:a,lineType:t,changing:r}=s(e),i=o({coins:e,lineType:t,changing:r,position:n.tosses.length+1,value:a,timestamp:(new Date).toISOString()}),l={...n,tosses:[...n.tosses,i],totalTosses:n.totalTosses+1};if(6===l.tosses.length){l.isComplete=!0,l.endTime=(new Date).toISOString();const n=b(l.tosses);h.value={hexagram:n,inputData:l}}else h.value={hexagram:null,inputData:l};return h.value}catch(e){throw c.value=e.message,e}},generateHexagramFromPlumBlossom:y,generateHexagramFromCoins:b,generateChangedHexagram:r=>{if(!r.changingLines||0===r.changingLines.length)return null;const i=[...r.lines].map(n=>({...n}));r.changingLines.forEach(e=>{const a=e-1;i[a]&&(i[a].type="yin"===i[a].type?"yang":"yin",i[a].changing=!1,i[a].symbol=n(i[a].type,!1))});const s=i.slice(0,3).map(n=>"yang"===n.type?"1":"0").join(""),o=i.slice(3,6).map(n=>"yang"===n.type?"1":"0").join(""),l=e(s),g=e(o);if(!l||!g)return null;const m=a(g,l);return m?t({id:`changed-hexagram-${m.number}`,name:m.name,symbol:m.symbol,upperTrigram:g,lowerTrigram:l,changingLines:[],lines:i,interpretation:m.interpretation,number:m.number}):null},calculatePlumBlossomNumber:w,calculateChangingLine:T,getTrigramNameByNumber:v}}export{c as A,u as C,p as a,h as u};
