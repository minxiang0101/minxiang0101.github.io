import{r as a,c as e,w as l,K as u,L as s,N as n,j as i,O as o,Q as t,B as r,_ as v,P as d,T as m,u as c}from"./vue-vendor-BDmscHTi.js";import{u as p,A as b}from"./useDivination-BlC7jHpl.js";import{_ as f}from"./index-BThmZv48.js";import{a as h}from"./vant-ui-B5UknOXi.js";const y={class:"plum-blossom-input"},g={class:"input-method"},N={class:"input-section"},_={key:0,class:"manual-input"},V={class:"input-tips"},k={key:1,class:"random-input"},w={class:"random-numbers"},M={class:"number-display"},x={class:"number-value"},B={class:"number-display"},I={class:"number-value"},j={class:"number-display"},U={class:"number-value"},P={class:"action-section"},D={class:"divination-animation"},C=f({__name:"PlumBlossomInput",emits:["divination-complete"],setup(f,{emit:C}){const{plumBlossomDivination:T,isProcessing:z}=p(),q=a("manual"),A=a(""),E=a(""),K=a(""),L=a(""),O=a(!1),Q=a(null),F=a([]),G=a(!1),H=a(!1),J=e(()=>"manual"===q.value?""!==A.value.trim():F.value.length>0&&void 0!==F.value[0]);l(q,()=>{"manual"===q.value?F.value=[]:(A.value="",E.value="",K.value="")});const R=a=>{const e="firstNumber"===a?A.value:"secondNumber"===a?E.value:K.value;return!e||!isNaN(e)&&!e.includes("-")||(h({message:"请输入有效的正整数"}),"firstNumber"===a&&(A.value=""),"secondNumber"===a&&(E.value=""),"thirdNumber"===a&&(K.value=""),!1)},S=async()=>{G.value=!0;try{await new Promise(a=>setTimeout(a,800)),F.value=[Math.floor(999*Math.random())+1,Math.floor(999*Math.random())+1,Math.floor(999*Math.random())+1]}catch(a){h({message:"生成随机数失败"})}finally{G.value=!1}},W=async()=>{try{let a=[];if("manual"===q.value){if(!R("firstNumber"))return;if(a.push(parseInt(A.value,10)),""!==E.value.trim()){if(!R("secondNumber"))return;a.push(parseInt(E.value,10))}if(""!==K.value.trim()){if(!R("thirdNumber"))return;a.push(parseInt(K.value,10))}}else a=[...F.value];H.value=!0,setTimeout(async()=>{try{const e=await T(a,"manual"===q.value?"manual":"random");Z("divination-complete",e)}catch(e){h({type:"fail",message:e.message||"卜卦失败，请重试"})}finally{H.value=!1}},b.MEDIUM)}catch(a){h({type:"fail",message:a.message||"操作失败，请重试"})}},X=a=>{"firstNumber"===Q.value?A.value+=a:"secondNumber"===Q.value?E.value+=a:"thirdNumber"===Q.value&&(K.value+=a)},Y=()=>{"firstNumber"===Q.value?A.value=A.value.slice(0,-1):"secondNumber"===Q.value?E.value=E.value.slice(0,-1):"thirdNumber"===Q.value&&(K.value=K.value.slice(0,-1))},Z=C;return(a,e)=>{const l=u("van-radio"),p=u("van-radio-group"),b=u("van-card"),f=u("van-field"),h=u("van-cell-group"),C=u("van-icon"),T=u("van-button"),Q=u("van-number-keyboard"),Z=u("van-loading"),$=u("van-popup");return n(),s("div",y,[i(b,{class:"input-card",border:!1},{title:t(()=>e[10]||(e[10]=[o("div",{class:"card-title"},"梅花易数卜卦",-1)])),desc:t(()=>e[11]||(e[11]=[o("div",{class:"card-desc"},"请输入或随机生成数字，系统将根据梅花易数算法计算卦象",-1)])),tags:t(()=>[o("div",g,[i(p,{modelValue:q.value,"onUpdate:modelValue":e[0]||(e[0]=a=>q.value=a),direction:"horizontal"},{default:t(()=>[i(l,{name:"manual"},{default:t(()=>e[12]||(e[12]=[r("手动输入",-1)])),_:1,__:[12]}),i(l,{name:"random"},{default:t(()=>e[13]||(e[13]=[r("随机生成",-1)])),_:1,__:[13]})]),_:1},8,["modelValue"])])]),_:1}),o("div",N,[i(m,{name:"fade"},{default:t(()=>["manual"===q.value?(n(),s("div",_,[i(h,{inset:""},{default:t(()=>[i(f,{modelValue:A.value,"onUpdate:modelValue":e[1]||(e[1]=a=>A.value=a),type:"digit",label:"上卦数",placeholder:"请输入数字",rules:[{required:!0,message:"请输入数字"}],onBlur:e[2]||(e[2]=a=>R("firstNumber"))},null,8,["modelValue"]),i(f,{modelValue:E.value,"onUpdate:modelValue":e[3]||(e[3]=a=>E.value=a),type:"digit",label:"下卦数",placeholder:"请输入数字（可选）",onBlur:e[4]||(e[4]=a=>R("secondNumber"))},null,8,["modelValue"]),i(f,{modelValue:K.value,"onUpdate:modelValue":e[5]||(e[5]=a=>K.value=a),type:"digit",label:"动爻数",placeholder:"请输入数字（可选）",onBlur:e[6]||(e[6]=a=>R("thirdNumber"))},null,8,["modelValue"])]),_:1}),o("div",V,[i(C,{name:"info-o"}),e[14]||(e[14]=r(" 提示：输入任意数字，系统将自动计算卦象 ",-1))])])):"random"===q.value?(n(),s("div",k,[o("div",w,[o("div",M,[e[15]||(e[15]=o("div",{class:"number-label"},"上卦数",-1)),o("div",x,d(F.value[0]||"?"),1)]),o("div",B,[e[16]||(e[16]=o("div",{class:"number-label"},"下卦数",-1)),o("div",I,d(F.value[1]||"?"),1)]),o("div",j,[e[17]||(e[17]=o("div",{class:"number-label"},"动爻数",-1)),o("div",U,d(F.value[2]||"?"),1)])]),i(T,{type:"primary",block:"",loading:G.value,onClick:S},{default:t(()=>[r(d(G.value?"生成中...":"随机生成数字"),1)]),_:1},8,["loading"])])):v("",!0)]),_:1})]),o("div",P,[i(T,{type:"primary",block:"",disabled:!J.value,loading:c(z),onClick:W},{default:t(()=>[r(d(c(z)?"卜卦中...":"开始卜卦"),1)]),_:1},8,["disabled","loading"])]),i(Q,{modelValue:L.value,"onUpdate:modelValue":e[7]||(e[7]=a=>L.value=a),show:O.value,onBlur:e[8]||(e[8]=a=>O.value=!1),onInput:X,onDelete:Y,maxlength:4,"extra-key":".","close-button-text":"完成",onClose:e[9]||(e[9]=a=>O.value=!1)},null,8,["modelValue","show"]),i($,{show:H.value,overlay:!0,"close-on-click-overlay":!1},{default:t(()=>[o("div",D,[i(Z,{type:"spinner",color:"#1989fa",size:"48px"}),e[18]||(e[18]=o("div",{class:"animation-text"},"正在演算卦象...",-1))])]),_:1},8,["show"])])}}},[["__scopeId","data-v-42bcba73"]]);export{C as P};
